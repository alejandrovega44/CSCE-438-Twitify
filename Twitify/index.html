<html>
<meta name ="viewpoint" content = "width=device-width, initial-scale = 1.0"> 

<link href  = "css/bootstrap.min.css" rel = "stylesheet">

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script> 
 

    <body>
    
		<div id = "AvailablePlaylists" class="dropdown">
		  
		  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
				Available Playlists
				<span class="caret"></span>
		  </button>
		  
		  <ul id = "contents" class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
		  </ul>
		  
		</div>
			
		<div class="row" style="padding-top: 30px; padding-bottom: 20px; background-color:#71C671 ">
			<center> <font size="7" color="black"> Twitify </font> </center>
			<div class="col-lg-4"></div>
			
			<div class="col-lg-4"></div>
		</div><!-- /.row -->
        <div class="col-lg-4"></div>
		<div class="col-lg-4 col-center-right" >
				<div class="input-group" >
					<input type="text" class="form-control text-center" placeholder = "Enter PlayList Name"  name = "PN" > 
					<span class="input-group-btn">
						<!-- Remove onClick not work as planned -->
						<button id = "Search" class="btn btn-default" button type="submit"> GO!</button>
					</span>
				</div><!-- /input-group -->
			
			</div><!-- /.col-lg-4 -->
        
        <div id="widgetcontainer" style="padding-top: 25px">
        
        </div>
       
        <script>
        
            var hostname = document.location.origin;
            var script_sucess = 0;
            var list_item = "";
            var responseArr = [] 
            var availableList =[] 
            
            //this runs the python script (an initiates the twitter crawler and playlist creation)
            $(document).ready(function() {
                
                 $.ajax( hostname + "/Twitify/Retrieveplaylist.py")
                      .done(function() {
                          script_success = 1;
                          
                      })
                      .fail(function() {
                        alert( "Error: System Failure" );
                    
                  });
            });
            
            
            //on click, sends the user's input (playlist name) to the backend 
            $(function()
            {
                $('#Search').click(function(){
                    
                    var playlist = document.getElementsByName('PN')[0].value;
                    $.ajax({
                        url: hostname + "/Twitify/Retrieveplaylist.py",
                        type: "post",
                        datatype:"json",
                        data: {'name':playlist},
                        success: function(response){
                             var responseData = JSON.stringify(response);
                             responseArr = eval(responseData);
                             //alert(responseArr[0]);
                             var playlistID = responseArr[0];
                             availableList = responseArr[1];
                             playlistID =  playlistID.replace(/"/g,"");
                             $('#widgetcontainer').html('');
                             var display_widget = '<center> <iframe src="https://embed.spotify.com/?uri=spotify:user:tamutwitify:playlist:' + playlistID + '&theme=white" frameborder="0" allowtransparency="true" width="400" height=500"></iframe> </center>';
                              $("#widgetcontainer").append(display_widget);
                              $('#contents').html('');
                             for(i = 0; i < availableList.length; i++)
                             {
                                 $("#contents").append('<li id = "' + availableList[i] + '" role="presentation"><a role="menuitem" tabindex="-1">' + availableList[i] +  '</a></li>');
                             }
                        }
                    });
                });
            });
            
             $(function()
            {
               $(document).on('click', '.dropdown-menu li a', function (){
                    
                   list_item = $(this).text();
                    //alert(list_item);
                    $.ajax({
                        url: hostname + "/Twitify/Retrieveplaylist.py",
                        type: "post",
                        datatype:"json",
                        data: {'name':list_item},
                        success: function(response){
                             var responseData = JSON.stringify(response);
                             responseArr = eval(responseData);
                             var playlistID = responseArr[0]; 
                             availableList = responseArr[1]; 
                             playlistID =  playlistID.replace(/"/g,"");
                             $('#widgetcontainer').html('');
                             var display_widget = '<center> <iframe src="https://embed.spotify.com/?uri=spotify:user:tamutwitify:playlist:' + playlistID + '&theme=white" frameborder="0" allowtransparency="true" width="400" height=500"></iframe> </center>';
                              $("#widgetcontainer").append(display_widget);
                              $('#contents').html('');
                              for(i = 0; i < availableList.length; i++)
                              {
                                 $("#contents").append('<li id = "' + availableList[i] + '" role="presentation"><a role="menuitem" tabindex="-1">' + availableList[i] +  '</a></li>');
                              }
                        }
                    });
                });
            });
            
            
        </script>
        
    </body>

</html>